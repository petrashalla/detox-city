{"version":3,"file":"request.js","sources":["request.js"],"sourcesContent":["document.addEventListener('DOMContentLoaded', () => {\n\n    const style = document.createElement('style');\n    style.type = 'text/css';\n    style.innerHTML = `.custom-error {\n        outline: 1px solid red !important;\n        }`;\n    document.head.appendChild(style);\n\n    function clearInput(button) {\n        const input = button.parentNode.querySelector('input');\n        input.value = '';\n        toggleClearButton(button);\n    }\n\n    function toggleClearButton(button) {\n        const input = button.parentNode.querySelector('input');\n        const clearButton = button;\n        if (input.value.length > 0) {\n            clearButton.style.display = 'block';\n        } else {\n            clearButton.style.display = 'none';\n        }\n    }\n\n    const clearInputButtons = document.querySelectorAll('.input-clear');\n    clearInputButtons.forEach(button => {\n        const input = button.parentNode.querySelector('input');\n        input.addEventListener('input', () => toggleClearButton(button));\n        toggleClearButton(button);\n        button.addEventListener('click', () => clearInput(button));\n    });\n\n    ;[].forEach.call(\n        document.querySelectorAll('input[type=tel]'),\n        function (input) {\n            let keyCode\n            function mask(event) {\n                event.keyCode && (keyCode = event.keyCode)\n                let pos = this.selectionStart\n                if (pos < 3) event.preventDefault()\n                let matrix = '+7 (___) ___-__-__',\n                    i = 0,\n                    def = matrix.replace(/\\D/g, ''),\n                    val = this.value.replace(/\\D/g, ''),\n                    new_value = matrix.replace(/[_\\d]/g, function (a) {\n                        return i < val.length ? val.charAt(i++) || def.charAt(i) : a\n                    })\n                i = new_value.indexOf('_')\n                if (i != -1) {\n                    i < 5 && (i = 3)\n                    new_value = new_value.slice(0, i)\n                }\n                let reg = matrix\n                    .substr(0, this.value.length)\n                    .replace(/_+/g, function (a) {\n                        return '\\\\d{1,' + a.length + '}'\n                    })\n                    .replace(/[+()]/g, '\\\\$&')\n                reg = new RegExp('^' + reg + '$')\n                if (\n                    !reg.test(this.value) ||\n                    this.value.length < 5 ||\n                    (keyCode > 47 && keyCode < 58)\n                )\n                    this.value = new_value\n                if (event.type == 'blur' && this.value.length < 5) this.value = ''\n            }\n            input.addEventListener('input', mask, false)\n            input.addEventListener('focus', mask, false)\n            input.addEventListener('blur', mask, false)\n            input.addEventListener('keydown', mask, false)\n        }\n    )\n    function GetYMCID() {\n        var match = document.cookie.match('(?:^|;)\\\\s*_ym_uid=([^;]*)');\n        return (match) ? decodeURIComponent(match[1]) : false;\n    }\n    const formButtons = document.querySelectorAll('button[type=\"submit\"]');\n\n    let key = mes = '';\n    const ajaxSend = async (formData) => {\n        const response = await fetch(\"/netcat_template/ajax/hash-check.php\", {\n            method: \"POST\",\n            body: formData\n        });\n        if (!response.ok) {\n            throw new Error(`Ошибка по адресу hash-check, статус ошибки ${response.status}`);\n        }\n        return await response.text();\n    };\n    const formData = new FormData();\n    if (document.querySelectorAll('input[name=mes]').length > 0) {\n        mes = document.querySelectorAll('input[name=mes]')[document.querySelectorAll('input[name=mes]').length - 1].value;\n    }\n    formData.append('checker', 1);\n    formData.append('mes', mes);\n    ajaxSend(formData)\n        .then((response) => {\n            key = response;\n            return key;\n        })\n        .catch((err) => console.error(err));\n\n    formButtons.forEach(button => {\n        const formObj = button.parentNode;\n        const divWrap = document.createElement('div');\n        divWrap.style.display = 'none';\n        divWrap.innerHTML =\n            `<input name=\"trafficSource\" type=\"hidden\" value=\"\">\n            <input name=\"istochnik\" type=\"hidden\" value=\"\">\n            <input name=\"clientID\" type=\"hidden\" value=\"${GetYMCID()}\">`;\n        formObj.appendChild(divWrap);\n\n        if (typeof sbjs !== 'undefined') {\n            sbjs.init(divWrap);\n            formObj.querySelector(\"input[name=trafficSource]\").value = sbjs.get.current.typ;\n            formObj.querySelector(\"input[name=istochnik]\").value = sbjs.get.current.src;\n        }\n\n        function getRandomNumber(min, max) {\n            return Math.ceil(Math.random() * (max - min)) + min - 1;\n        }\n        setTimeout(function () {\n            if (key != '') {\n                const input = document.createElement('input');\n                input.name = 'f_haystack';\n                input.type = 'hidden';\n                input.value = key;\n                formObj.appendChild(input);\n            }\n        }, getRandomNumber(5000, 7000));\n        const responeModalOk = document.querySelector('[data-modal-ok]');\n        const responeModalError = document.querySelector('[data-modal-err]');\n        button.addEventListener('click', async function (event) {\n            event.preventDefault();\n            const form = this.closest('form');\n            modalOpen = responeModalOk.dataset.modalOpen;\n            const fields = {};\n            const inputs = form.querySelectorAll('input[type=\"tel\"], textarea, input[type=\"text\"]');\n            inputs.forEach(input => {\n                if (input.hasAttribute('required')) {\n                    fields[input.name] = {\n                        type: input.type,\n                        value: input.value\n                    };\n                }\n            })\n            if (responeModalOk === responeModalError) {\n                modalOk = modalErr = responeModalOk.querySelector('.' + responeModalOk.dataset.modalOk);\n            } else {\n                modalOk = responeModalOk.querySelector('.' + responeModalOk.dataset.modalOk);\n                modalErr = responeModalError.querySelector('.' + responeModalError.dataset.modalErr);\n            }\n            const resultWrappers = {\n                success: modalOk,\n                error: modalErr\n            };\n            if (validateInputs(fields)) {\n                await handleSubmission(this, form, resultWrappers, modalOpen);\n            } else {\n                markErrors(form);\n            }\n        });\n\n        const urlInputs = document.querySelectorAll(\"input[name='urlMessage'], input[name='title_url_message']\");\n        urlInputs.forEach(input => {\n            const cleanUrl = `${window.location.origin}${window.location.pathname}`;\n            input.value = input.name === 'urlMessage' ? cleanUrl : document.title;\n        });\n    });\n\n    async function handleSubmission(button, form, resultWrappers, modalOpen) {\n        const originalText = button.innerText;\n        button.innerHTML = \"Отправление\";\n        button.disabled = true;\n        try {\n            const response = await fetch(`/netcat_template/ajax/request.php`, {\n                method: 'POST',\n                body: new FormData(form)\n            });\n            const responseText = await response.text();\n            const isSuccess = response.ok;\n            openModal(isSuccess ? resultWrappers.success : resultWrappers.error, responseText, modalOpen);\n\n        } catch (error) {\n            openModal(resultWrappers.error, error.message, modalOpen);\n        } finally {\n            resetButton(button, originalText);\n        }\n    }\n\n    function openModal(wrapper, content, modalOpen) {\n\n        const modal = wrapper.closest('.popup');\n        wrapper.innerHTML = content;\n        const classes = modalOpen.split(' ');\n        classes.forEach(item => {\n            modal.classList.add(item);\n        });\n    }\n    function resetButton(button, buttonText) {\n        button.innerText = buttonText;\n        button.disabled = false;\n    }\n\n    function markErrors(form) {\n        const inputs = form.querySelectorAll('input[type=\"tel\"], textarea, input[type=\"text\"]');\n        inputs.forEach(input => {\n            switch (input.type) {\n                case 'tel':\n                    const phoneNumber = input.value.replace(/\\D/g, '');\n                    if (phoneNumber.length < 11) {\n                        addErrorStyleNotification(input, \"Введите верный номер телефона\");\n                        setTimeout(() => {\n                            removeErrorStyleNotification(input);\n                        }, 2000);\n                    }\n                    break;\n                case 'textarea':\n                case 'text':\n                    if (!/[а-яА-ЯёЁ]/.test(input.value) || input.value.trim().length <= 2) {\n                        addErrorStyleNotification(input, \"Текст должен содержать русские буквы\");\n                        setTimeout(() => {\n                            removeErrorStyleNotification(input);\n                        }, 2000);\n                    }\n                    break;\n                default:\n                    addErrorStyleNotification(input, \"Поле не заполнено\");\n                    setTimeout(() => {\n                        removeErrorStyleNotification(input);\n                    }, 1000);\n                    break;\n            }\n        })\n    }\n\n    function validateInputs(fields) {\n        let isValid = true;\n        for (let fieldName in fields) {\n            const field = fields[fieldName];\n            switch (field.type) {\n                case 'tel':\n                    const phoneNumber = field.value.replace(/\\D/g, '');\n                    if (phoneNumber.length < 11) {\n                        isValid = false;\n                    }\n                    break;\n                case 'textarea':\n                case 'text':\n                    if (!/[а-яА-ЯёЁ]/.test(field.value) || field.value.trim().length <= 2) {\n                        isValid = false;\n                    }\n                    break;\n                default:\n                    isValid = false;\n                    break;\n            }\n        }\n        return isValid;\n    }\n    function addErrorStyleNotification(input, text) {\n        input.classList.add('custom-error');\n        input.setCustomValidity(text);\n        input.reportValidity();\n    }\n    function removeErrorStyleNotification(input) {\n        input.setCustomValidity('')\n        input.classList.remove('custom-error');\n    }\n});"],"names":["document","addEventListener","style","createElement","toggleClearButton","button","input","parentNode","querySelector","value","length","clearButton","display","type","innerHTML","head","appendChild","querySelectorAll","forEach","call","let","keyCode","mask","event","this","selectionStart","preventDefault","matrix","i","def","replace","val","new_value","a","charAt","indexOf","slice","reg","substr","RegExp","test","formButtons","key","mes","formData","FormData","openModal","wrapper","content","modalOpen","modal","closest","split","item","classList","add","addErrorStyleNotification","text","setCustomValidity","reportValidity","removeErrorStyleNotification","remove","append","async","response","await","fetch","method","body","ok","Error","status","then","catch","console","error","err","formObj","min","divWrap","match","cookie","decodeURIComponent","sbjs","init","get","current","typ","src","setTimeout","name","max","Math","ceil","random","responeModalOk","responeModalError","form","dataset","fields","hasAttribute","modalOk","modalErr","resultWrappers","success","isValid","fieldName","field","trim","handleSubmission","originalText","innerText","disabled","responseText","message","buttonText","cleanUrl","window","location","origin","pathname","title"],"mappings":"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"}